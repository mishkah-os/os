!function(root,factory){if(typeof define==='function'&&define.amd){define(['mishkah','mishkah-react'],function(M,R){return factory(root,M,R)})}else if(typeof module==='object'&&module.exports){module.exports=factory(root,require('mishkah'),require('mishkah-react'))}else{root.Mishkah=root.Mishkah||{};root.Mishkah.Vue=factory(root,root.Mishkah,root.Mishkah.React)}}(typeof window!=='undefined'?window:this,function(global,M,R){'use strict';if(!R||!R.render){console.error('Mishkah.Vue requires Mishkah.React');return{}}var _globalDb=null;var _contexts={};function getGlobalDb(){if(!_globalDb&&global.Mishkah&&global.Mishkah.Database){_globalDb=global.Mishkah.Database}return _globalDb}var DatabaseContext=R.createContext(null);var I18nContext=R.createContext({lang:'ar',dir:'rtl',t:function(k){return k}});var ThemeContext=R.createContext({theme:'dark',tokens:{}});function ref(initialValue){var state=R.useState({v:initialValue});var s=state[0];var set=state[1];return{get value(){return s.v},set value(nv){set({v:nv})}}}function reactive(obj){var state=R.useState(obj);var s=state[0];var set=state[1];return new Proxy(s,{get:function(t,p){return t[p]},set:function(t,p,v){var ns=Array.isArray(t)?[...t]:{...t};ns[p]=v;set(ns);return true}})}function computed(getter){return R.useMemo(getter,[])}function watch(source,callback,options){var prev=R.useRef(null);R.useEffect(function(){var val=typeof source==='function'?source():source.value;if(prev.current!==null||options?.immediate){callback(val,prev.current)}prev.current=val})}function watchEffect(fn){R.useEffect(fn)}function onMounted(fn){R.useEffect(function(){fn()},[]) }function onUnmounted(fn){R.useEffect(function(){return fn},[])}function onUpdated(fn){R.useEffect(fn)}function onBeforeMount(fn){onMounted(fn)}function onBeforeUnmount(fn){onUnmounted(fn)}function onBeforeUpdate(fn){R.useEffect(function(){fn()})}function useDatabase(){var db=R.useContext(DatabaseContext);if(!db){db=getGlobalDb()}var dbRef=ref(db);R.useEffect(function(){dbRef.value=db},[db]);return{data:dbRef,get:function(path){var parts=path.split('.');var val=db;for(var i=0;i<parts.length;i++){val=val?val[parts[i]]:null}return val},set:function(path,value){var parts=path.split('.');var obj=db;for(var i=0;i<parts.length-1;i++){obj=obj[parts[i]]}obj[parts[parts.length-1]]=value;if(db.env&&typeof M.saveEnvToStorage==='function'){M.saveEnvToStorage(db.env)}},save:function(){if(db.env&&typeof M.saveEnvToStorage==='function'){M.saveEnvToStorage(db.env)}},reset:function(){if(typeof M.loadEnvFromStorage==='function'){M.loadEnvFromStorage()}}}}function useI18n(){var i18n=R.useContext(I18nContext);var i18nRef=reactive({lang:i18n.lang,dir:i18n.dir,t:i18n.t});R.useEffect(function(){i18nRef.lang=i18n.lang;i18nRef.dir=i18n.dir;i18nRef.t=i18n.t},[i18n.lang,i18n.dir]);return{lang:computed(function(){return i18nRef.lang}),dir:computed(function(){return i18nRef.dir}),t:i18nRef.t,setLang:function(newLang){if(typeof R.toggleLang==='function'){R.toggleLang()}else if(global.Mishkah&&global.Mishkah.toggleLang){global.Mishkah.toggleLang()}},toggleLang:function(){if(typeof R.toggleLang==='function'){R.toggleLang()}else if(global.Mishkah&&global.Mishkah.toggleLang){global.Mishkah.toggleLang()}}}}function useTheme(){var theme=R.useContext(ThemeContext);var tokens=theme.tokens||{colors:{},spacing:{},radius:{},fonts:{}};var themeRef=reactive({current:theme.theme,tokens:tokens});R.useEffect(function(){themeRef.current=theme.theme;themeRef.tokens=tokens;injectCSSTokens(tokens)},[theme.theme]);return{theme:computed(function(){return themeRef.current}),tokens:themeRef.tokens,vars:generateCSSVars(tokens),setTheme:function(newTheme){if(typeof R.toggleTheme==='function'){R.toggleTheme()}else if(global.Mishkah&&global.Mishkah.toggleTheme){global.Mishkah.toggleTheme()}},toggleTheme:function(){if(typeof R.toggleTheme==='function'){R.toggleTheme()}else if(global.Mishkah&&global.Mishkah.toggleTheme){global.Mishkah.toggleTheme()}}}}function injectCSSTokens(tokens){if(typeof document==='undefined')return;var root=document.documentElement;if(tokens.colors){Object.keys(tokens.colors).forEach(function(k){root.style.setProperty('--color-'+k,tokens.colors[k])})}if(tokens.spacing){Object.keys(tokens.spacing).forEach(function(k){root.style.setProperty('--spacing-'+k,tokens.spacing[k])})}if(tokens.radius){Object.keys(tokens.radius).forEach(function(k){root.style.setProperty('--radius-'+k,tokens.radius[k])})}if(tokens.fonts){Object.keys(tokens.fonts).forEach(function(k){root.style.setProperty('--font-'+k,tokens.fonts[k])})}}function generateCSSVars(tokens){var vars={};if(tokens.colors){Object.keys(tokens.colors).forEach(function(k){vars['--color-'+k]=tokens.colors[k]})}if(tokens.spacing){Object.keys(tokens.spacing).forEach(function(k){vars['--spacing-'+k]=tokens.spacing[k]})}if(tokens.radius){Object.keys(tokens.radius).forEach(function(k){vars['--radius-'+k]=tokens.radius[k]})}if(tokens.fonts){Object.keys(tokens.fonts).forEach(function(k){vars['--font-'+k]=tokens.fonts[k]})}return vars}function provide(key,value){_contexts[key]=value}function inject(key,defaultValue){return _contexts[key]||defaultValue}function createApp(options){var isComposition=!!options.setup;if(isComposition){return createCompositionApp(options)}else{return createOptionsApp(options)}}function createCompositionApp(options){function Component(props){var setupResult=options.setup(props,{expose:function(){},emit:function(){}});var ctx={};if(setupResult&&typeof setupResult==='object'){Object.keys(setupResult).forEach(function(k){var val=setupResult[k];if(val&&typeof val==='object'&&'value'in val){Object.defineProperty(ctx,k,{get:function(){return val.value},enumerable:true})}else{ctx[k]=val}})}if(typeof setupResult==='function'){return setupResult()}if(options.template){if(typeof options.template==='function'){return options.template.call(ctx)}return options.template}return null}return{mount:function(selector){var container=typeof selector==='string'?document.querySelector(selector):selector;R.render(Component,container)}}}function createOptionsApp(options){function Component(props){var initialData=typeof options.data==='function'?options.data():(options.data||{});var dataState=reactive(initialData);var $db=useDatabase();var $i18n=useI18n();var $theme=useTheme();var ctx={$props:props,$db:$db,$i18n:$i18n,$theme:$theme,$emit:function(event,payload){console.log('Emit:',event,payload)}};if(options.methods){Object.keys(options.methods).forEach(function(k){ctx[k]=options.methods[k].bind(ctx)})}var proxy=new Proxy(ctx,{get:function(target,prop){if(prop in dataState){return dataState[prop]}if(prop in target){return target[prop]}return undefined},set:function(target,prop,value){if(prop in dataState){dataState[prop]=value;return true}target[prop]=value;return true}});if(options.methods){Object.keys(options.methods).forEach(function(k){ctx[k]=options.methods[k].bind(proxy)})}onMounted(function(){if(options.mounted){options.mounted.call(proxy)}});onUnmounted(function(){if(options.unmounted){options.unmounted.call(proxy)}});if(options.template){if(typeof options.template==='function'){return options.template.call(proxy)}return options.template}return M.h('div','Vue',{},['No template'])}return{mount:function(selector){var container=typeof selector==='string'?document.querySelector(selector):selector;R.render(Component,container)}}}function h(){return R.createElement.apply(null,arguments)}function createVNode(){return R.createElement.apply(null,arguments)}function defineComponent(options){return options}function defineProps(){}function defineEmits(){}function withDefaults(){}function defineExpose(){}var nextTick=typeof queueMicrotask!=='undefined'?function(fn){queueMicrotask(fn)}:function(fn){Promise.resolve().then(fn)};function toRef(obj,key){return computed(function(){return obj[key]})}function toRefs(obj){var refs={};Object.keys(obj).forEach(function(k){refs[k]=toRef(obj,k)});return refs}function unref(r){return r&&typeof r==='object'&&'value' in r?r.value:r}function isRef(r){return r&&typeof r==='object'&&'value' in r}function isReactive(r){return r&&typeof r==='object'&&r.constructor===Object}function shallowRef(v){return ref(v)}function shallowReactive(obj){return reactive(obj)}function readonly(obj){return new Proxy(obj,{get:function(t,p){return t[p]},set:function(){console.warn('Cannot modify readonly object');return false}})}function markRaw(obj){return obj}function toRaw(obj){return obj}function triggerRef(r){r.value=r.value}function customRef(factory){var get,set;var trigger=function(){};var track=function(){};factory(track,trigger);return{get value(){track();return get()},set value(v){set(v);trigger()}}}var VueAPI={createApp:createApp,defineComponent:defineComponent,h:h,createVNode:createVNode,ref:ref,reactive:reactive,computed:computed,readonly:readonly,watch:watch,watchEffect:watchEffect,toRef:toRef,toRefs:toRefs,unref:unref,isRef:isRef,isReactive:isReactive,shallowRef:shallowRef,shallowReactive:shallowReactive,markRaw:markRaw,toRaw:toRaw,triggerRef:triggerRef,customRef:customRef,provide:provide,inject:inject,onMounted:onMounted,onUnmounted:onUnmounted,onUpdated:onUpdated,onBeforeMount:onBeforeMount,onBeforeUnmount:onBeforeUnmount,onBeforeUpdate:onBeforeUpdate,nextTick:nextTick,useDatabase:useDatabase,useI18n:useI18n,useTheme:useTheme,defineProps:defineProps,defineEmits:defineEmits,withDefaults:withDefaults,defineExpose:defineExpose,html:R.html,version:'3.0.0-mishkah'};return VueAPI});
