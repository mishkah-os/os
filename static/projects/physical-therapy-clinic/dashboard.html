<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ERP - Ù…Ø±ÙƒØ² Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ | ERP Dashboard - Physical Therapy Center</title>
  <!-- Load Mishkah Libraries -->
  <script src="../../lib/mishkah-utils.js"></script>
  <script src="../../lib/mishkah.core.js"></script>
  <script src="../../lib/mishkah-ui.js"></script>
</head>
<body>
  <div id="app"></div>

  <script>
    (async function() {
      const M = Mishkah;
      const D = M.DSL;
      const UI = M.UI;
      const { tw, token } = M.utils.twcss;

      // Application State
      const db = {
        env: {
          lang: 'ar',
          dir: 'rtl',
          theme: 'light'
        },
        data: {
          currentPage: 'dashboard',
          showModal: false,
          modalType: null,
          patients: [
            { id: 1, name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', phone: '01012345678', status: 'active', lastVisit: '2024-01-15', totalSessions: 12 },
            { id: 2, name: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', phone: '01023456789', status: 'active', lastVisit: '2024-01-14', totalSessions: 8 },
            { id: 3, name: 'Ù…Ø­Ù…ÙˆØ¯ Ø³Ø§Ù„Ù…', phone: '01034567890', status: 'completed', lastVisit: '2024-01-10', totalSessions: 15 }
          ],
          appointments: [
            { id: 1, patientName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', date: '2024-01-16', time: '10:00', service: 'Ø¹Ù„Ø§Ø¬ Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø¸Ù‡Ø±', status: 'confirmed' },
            { id: 2, patientName: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', date: '2024-01-16', time: '11:00', service: 'Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…ÙØ§ØµÙ„', status: 'pending' },
            { id: 3, patientName: 'Ù…Ø­Ù…ÙˆØ¯ Ø³Ø§Ù„Ù…', date: '2024-01-16', time: '14:00', service: 'Ø¹Ù„Ø§Ø¬ Ø±ÙŠØ§Ø¶ÙŠ', status: 'confirmed' }
          ],
          stats: {
            totalPatients: 145,
            todayAppointments: 12,
            completedSessions: 1250,
            revenue: 125000
          }
        },
        i18n: {
          dict: {
            'dashboard': { ar: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', en: 'Dashboard' },
            'patients': { ar: 'Ø§Ù„Ù…Ø±Ø¶Ù‰', en: 'Patients' },
            'appointments': { ar: 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', en: 'Appointments' },
            'sessions': { ar: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª', en: 'Sessions' },
            'reports': { ar: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', en: 'Reports' },
            'settings': { ar: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', en: 'Settings' },
            'totalPatients': { ar: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰', en: 'Total Patients' },
            'todayAppointments': { ar: 'Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…', en: "Today's Appointments" },
            'completedSessions': { ar: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©', en: 'Completed Sessions' },
            'revenue': { ar: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', en: 'Revenue' },
            'recentPatients': { ar: 'Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø£Ø®ÙŠØ±ÙˆÙ†', en: 'Recent Patients' },
            'upcomingAppointments': { ar: 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©', en: 'Upcoming Appointments' },
            'addNew': { ar: 'Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯', en: 'Add New' },
            'name': { ar: 'Ø§Ù„Ø§Ø³Ù…', en: 'Name' },
            'phone': { ar: 'Ø§Ù„Ù‡Ø§ØªÙ', en: 'Phone' },
            'status': { ar: 'Ø§Ù„Ø­Ø§Ù„Ø©', en: 'Status' },
            'lastVisit': { ar: 'Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©', en: 'Last Visit' },
            'patient': { ar: 'Ø§Ù„Ù…Ø±ÙŠØ¶', en: 'Patient' },
            'date': { ar: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', en: 'Date' },
            'time': { ar: 'Ø§Ù„ÙˆÙ‚Øª', en: 'Time' },
            'service': { ar: 'Ø§Ù„Ø®Ø¯Ù…Ø©', en: 'Service' },
            'active': { ar: 'Ù†Ø´Ø·', en: 'Active' },
            'completed': { ar: 'Ù…ÙƒØªÙ…Ù„', en: 'Completed' },
            'confirmed': { ar: 'Ù…Ø¤ÙƒØ¯', en: 'Confirmed' },
            'pending': { ar: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', en: 'Pending' },
            'cancelled': { ar: 'Ù…Ù„ØºÙ‰', en: 'Cancelled' }
          }
        }
      };

      // Translation Helper
      const t = function(key) {
        const lang = db.env.lang || 'ar';
        const dict = db.i18n.dict || {};
        return dict[key] && dict[key][lang] ? dict[key][lang] : key;
      };

      // Event Handlers
      const orders = {
        'nav:click': {
          on: ['click'],
          gkeys: ['nav:click'],
          handler: function(event, context) {
            const page = event.target.dataset.page;
            const state = context.getState();
            state.data.currentPage = page;
            context.rebuild();
          }
        },

        'lang:switch': {
          on: ['click'],
          gkeys: ['lang:switch'],
          handler: function(event, context) {
            const newLang = event.target.dataset.lang;
            const state = context.getState();
            state.env.lang = newLang;
            state.env.dir = newLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.setAttribute('lang', newLang);
            document.documentElement.setAttribute('dir', state.env.dir);
            context.rebuild();
          }
        },

        'theme:toggle': {
          on: ['click'],
          gkeys: ['theme:toggle'],
          handler: function(event, context) {
            const state = context.getState();
            state.env.theme = state.env.theme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', state.env.theme);
            context.rebuild();
          }
        },

        'modal:open': {
          on: ['click'],
          gkeys: ['modal:open'],
          handler: function(event, context) {
            const modalType = event.target.dataset.modalType;
            const state = context.getState();
            state.data.showModal = true;
            state.data.modalType = modalType;
            context.rebuild();
          }
        },

        'modal:close': {
          on: ['click'],
          gkeys: ['modal:close'],
          handler: function(event, context) {
            const state = context.getState();
            state.data.showModal = false;
            state.data.modalType = null;
            context.rebuild();
          }
        }
      };

      // Components
      function Sidebar(db, D) {
        return D.Containers.Aside({ attrs: { class: tw`w-[250px] bg-[var(--card)] border-r border-[var(--border)] p-6 fixed h-screen overflow-y-auto` } }, [
          D.Containers.Div({ attrs: { class: tw`mb-8 pb-4 border-b border-[var(--border)]` } }, [
            D.Text.H2({ attrs: { class: tw`text-lg font-bold text-[var(--primary)]` } }, ['ERP - Ù…Ø±ÙƒØ² Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ'])
          ]),
          D.Lists.Ul({ attrs: { class: 'sidebar-menu' } }, [
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'dashboard' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'dashboard'
                }
              }, ['ğŸ“Š ' + t('dashboard')])
            ]),
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'patients' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'patients'
                }
              }, ['ğŸ‘¥ ' + t('patients')])
            ]),
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'appointments' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'appointments'
                }
              }, ['ğŸ“… ' + t('appointments')])
            ]),
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'sessions' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'sessions'
                }
              }, ['ğŸ’† ' + t('sessions')])
            ]),
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'reports' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'reports'
                }
              }, ['ğŸ“ˆ ' + t('reports')])
            ]),
            D.Lists.Li({ attrs: { class: 'sidebar-menu-item' } }, [
              D.Text.A({
                attrs: {
                  class: tw`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors cursor-pointer ${db.data.currentPage === 'settings' ? 'bg-[var(--primary)] text-[var(--primary-foreground)]' : 'hover:bg-[var(--accent)]'}`,
                  'data-m-gkey': 'nav:click',
                  'data-page': 'settings'
                }
              }, ['âš™ï¸ ' + t('settings')])
            ])
          ])
        ]);
      }

      function Header(db, D) {
        return D.Containers.Div({ attrs: { class: tw`${token('split')} mb-8 pb-4 border-b border-[var(--border)]` } }, [
          D.Text.H1({ attrs: { class: tw`text-2xl font-bold` } }, [t(db.data.currentPage)]),
          D.Containers.Div({ attrs: { class: tw`${token('hstack')}` } }, [
            UI.Switcher({
              attrs: { 'data-m-gkey': 'lang:switch' },
              value: db.env.lang,
              options: [
                { label: 'Ø¹', value: 'ar', attrs: { 'data-lang': 'ar' } },
                { label: 'EN', value: 'en', attrs: { 'data-lang': 'en' } }
              ]
            }),
            UI.Button({
              attrs: {
                'data-m-gkey': 'theme:toggle',
                title: db.env.theme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'
              },
              variant: 'ghost',
              size: 'md'
            }, [db.env.theme === 'dark' ? 'ğŸŒ' : 'ğŸŒ™'])
          ])
        ]);
      }

      function StatsGrid(db, D) {
        return D.Containers.Div({ attrs: { class: tw`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8` } }, [
          D.Containers.Div({ attrs: { class: tw`${token('card')} p-6` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('split')} mb-4` } }, [
              D.Text.Span({ attrs: { class: tw`text-sm font-medium ${token('muted')}` } }, [t('totalPatients')]),
              D.Text.Span({ attrs: { class: tw`text-2xl` } }, ['ğŸ‘¥'])
            ]),
            D.Containers.Div({ attrs: { class: tw`text-3xl font-bold mb-2` } }, [String(db.data.stats.totalPatients)]),
            D.Containers.Div({ attrs: { class: tw`text-sm text-green-600` } }, ['â†‘ 12% Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ'])
          ]),
          D.Containers.Div({ attrs: { class: tw`${token('card')} p-6` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('split')} mb-4` } }, [
              D.Text.Span({ attrs: { class: tw`text-sm font-medium ${token('muted')}` } }, [t('todayAppointments')]),
              D.Text.Span({ attrs: { class: tw`text-2xl` } }, ['ğŸ“…'])
            ]),
            D.Containers.Div({ attrs: { class: tw`text-3xl font-bold mb-2` } }, [String(db.data.stats.todayAppointments)]),
            D.Containers.Div({ attrs: { class: tw`text-sm ${token('muted')}` } }, ['5 Ù…Ø¤ÙƒØ¯ØŒ 7 Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'])
          ]),
          D.Containers.Div({ attrs: { class: tw`${token('card')} p-6` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('split')} mb-4` } }, [
              D.Text.Span({ attrs: { class: tw`text-sm font-medium ${token('muted')}` } }, [t('completedSessions')]),
              D.Text.Span({ attrs: { class: tw`text-2xl` } }, ['âœ…'])
            ]),
            D.Containers.Div({ attrs: { class: tw`text-3xl font-bold mb-2` } }, [String(db.data.stats.completedSessions)]),
            D.Containers.Div({ attrs: { class: tw`text-sm text-green-600` } }, ['â†‘ 8% Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ'])
          ]),
          D.Containers.Div({ attrs: { class: tw`${token('card')} p-6` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('split')} mb-4` } }, [
              D.Text.Span({ attrs: { class: tw`text-sm font-medium ${token('muted')}` } }, [t('revenue')]),
              D.Text.Span({ attrs: { class: tw`text-2xl` } }, ['ğŸ’°'])
            ]),
            D.Containers.Div({ attrs: { class: tw`text-3xl font-bold mb-2` } }, [String(db.data.stats.revenue) + ' Ø¬.Ù…']),
            D.Containers.Div({ attrs: { class: tw`text-sm text-green-600` } }, ['â†‘ 15% Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ'])
          ])
        ]);
      }

      function DashboardPage(db, D) {
        return D.Containers.Div({}, [
          StatsGrid(db, D),
          D.Containers.Div({ attrs: { class: tw`${token('card')} mb-6` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('card/header')}` } }, [
              D.Text.H2({ attrs: { class: tw`${token('card/title')}` } }, [t('recentPatients')]),
              UI.Button({
                attrs: {
                  'data-m-gkey': 'modal:open',
                  'data-modal-type': 'patient'
                },
                variant: 'solid',
                size: 'sm'
              }, ['+ ' + t('addNew')])
            ]),
            D.Containers.Div({ attrs: { class: tw`${token('card/content')} overflow-x-auto` } }, [
              D.Containers.Table({ attrs: { class: tw`w-full` } }, [
                D.Containers.Thead({ attrs: { class: tw`bg-[var(--surface-1)]` } }, [
                  D.Containers.Tr({}, [
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('name')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('phone')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('status')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('lastVisit')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('sessions')])
                  ])
                ]),
                D.Containers.Tbody({},
                  db.data.patients.map(function(patient) {
                    return D.Containers.Tr({ attrs: { key: patient.id, class: tw`hover:bg-[var(--accent)]` } }, [
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [patient.name]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [patient.phone]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [
                        D.Text.Span({
                          attrs: {
                            class: tw`${token('badge')} ${patient.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}`
                          }
                        }, [t(patient.status)])
                      ]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [patient.lastVisit]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [String(patient.totalSessions)])
                    ]);
                  })
                )
              ])
            ])
          ]),
          D.Containers.Div({ attrs: { class: tw`${token('card')}` } }, [
            D.Containers.Div({ attrs: { class: tw`${token('card/header')}` } }, [
              D.Text.H2({ attrs: { class: tw`${token('card/title')}` } }, [t('upcomingAppointments')]),
              UI.Button({
                attrs: {
                  'data-m-gkey': 'modal:open',
                  'data-modal-type': 'appointment'
                },
                variant: 'solid',
                size: 'sm'
              }, ['+ ' + t('addNew')])
            ]),
            D.Containers.Div({ attrs: { class: tw`${token('card/content')} overflow-x-auto` } }, [
              D.Containers.Table({ attrs: { class: tw`w-full` } }, [
                D.Containers.Thead({ attrs: { class: tw`bg-[var(--surface-1)]` } }, [
                  D.Containers.Tr({}, [
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('patient')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('date')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('time')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('service')]),
                    D.Containers.Th({ attrs: { class: tw`p-3 text-right font-semibold border-b-2 border-[var(--border)]` } }, [t('status')])
                  ])
                ]),
                D.Containers.Tbody({},
                  db.data.appointments.map(function(appointment) {
                    return D.Containers.Tr({ attrs: { key: appointment.id, class: tw`hover:bg-[var(--accent)]` } }, [
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [appointment.patientName]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [appointment.date]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [appointment.time]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [appointment.service]),
                      D.Containers.Td({ attrs: { class: tw`p-3 border-b border-[var(--border)]` } }, [
                        D.Text.Span({
                          attrs: {
                            class: tw`${token('badge')} ${appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`
                          }
                        }, [t(appointment.status)])
                      ])
                    ]);
                  })
                )
              ])
            ])
          ])
        ]);
      }

      function MainContent(db, D) {
        return D.Containers.Main({ attrs: { class: tw`flex-1 ml-[250px] p-8 ${token('surface')}` } }, [
          Header(db, D),
          db.data.currentPage === 'dashboard' ? DashboardPage(db, D) : D.Text.P({}, ['ØµÙØ­Ø© ' + t(db.data.currentPage) + ' Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±'])
        ]);
      }

      // Main App Body
      M.app.setBody(function(stateWrapper, D) {
        const state = stateWrapper;

        return D.Containers.Div({ attrs: { class: tw`flex min-h-screen ${token('surface')}` } }, [
          Sidebar(state, D),
          MainContent(state, D)
        ]);
      });

      // Create and Mount App
      const app = M.app.createApp(db, orders);
      app.mount('#app');

      console.log('ERP Dashboard loaded successfully!');
    })();
  </script>
</body>
</html>
